#include <18F4550.h>
#fuses NOPROTECT, NOWDT, HS, PLL1, CPUDIV1
#device PASS_STRINGS = IN_RAM
#include <stdlib.h>
#use delay(clocK=20M)
#use I2C(MASTER, SDA=PIN_B0, SCL=PIN_B1, FAST, stream = SSD1306_STREAM)
#USE I2C(MASTER, SDA=PIN_B0, SCL=PIN_B1, SLOW, STREAM= DS3231_STREAM)
#include <SSD1306OLED.c>
#include <DS3231.c>
#use rs232(rcv=pin_c7, xmit=pin_c6, baud=9600, bits=8 ,parity=n)

// REGISTROS PUERTOS
#BYTE TRISD=0xF95
#BYTE PORTD=0xF83
#BIT RD7=0xF83.7
#BIT RD0=0xF83.0

// REGISTROS ADC
#BYTE ADCON0=0xFC2
#BIT GO_DONE=0xFC2.1
#BYTE ADCON1=0xFC1
#BYTE ADCON2=0xFC0
#BYTE ADRESH=0xFC4
#BYTE ADRESL=0xFC3

int i,j;

// VARIABLES SENSOR PASOS
int A=15,B=25; // COORDENADAS MEGAMAN
int1 flag_push_st=0; // BANDERA - SE DETECTA UN PULSO
int flag_count_st=0; // BANDERA - 5 PULSOS = 1 PASO
int16 count_st=0; // VALOR DIGITAL - PASOS ALMACENADOS
char data_t_st[3]; // STRING - VALOR CONVERTIDO A STRING
char salto_st[2]={0x0D,0x0A}; // STRING - SALTO DE LINEA

// VARIABLES SENSOR PULSOS
int cg=40,yx=0,yz=0; // VARIABLES GRÁFICAS
int C=7,D=38; // COORDENADAS CORAZÓN
int16 data=0; // VALOR DIGITAL DE SENSOR DE PULSOS
char data_t[3]; // STRING PARA ALMACENAR VALOR CONVERTIDO
int1 flag_p=0; // BANDERA PARA SABER SI SE ESTÁ MIDIENDO EL PULSO
char salto[2]={0x0D,0x0A};

// VARIABLES CAMBIO PANTALLA
int screen=1;
int1 flag_push_screen=0;
int1 flag_loop=0;
char letter=0;

// VARIABLES RTC
char timp[20], fecha[20];
RTC_Time *mytime;

// VARIABLES LLAMADA
int pr_screen=0;
//char llamar[6];
char llamar[10];
char intep[20];
int count_l=0;
int E=65,F=38;
int G=5,H=15;
char letra_x;
// GRÁFICOS

int1 mega_1[30][30]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,1,1,0,1,1,0,1,1,1,0,1,0,0,1,1,1,0,1,0,0,0,0,0,0,0,0,
0,0,0,0,1,0,0,0,1,0,1,1,1,0,0,0,0,1,1,1,0,1,0,0,0,0,0,0,0,0,
0,0,0,1,1,0,0,0,1,0,1,0,0,0,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,
0,0,1,1,1,1,1,0,0,1,1,0,0,0,0,1,1,1,0,1,0,1,0,0,0,1,1,1,1,0,
0,1,1,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,
1,1,1,1,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,0,0,1,1,1,0,1,1,1,1,1,0,1,0,0,0,1,1,1,1,1,1,
1,1,1,1,1,1,0,1,0,0,0,1,1,0,0,0,0,0,0,1,0,1,0,0,1,1,1,1,1,1,
0,0,1,1,1,0,0,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,
0,0,0,0,0,0,0,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,
0,0,0,0,1,1,1,0,1,1,1,1,1,0,0,0,0,1,1,0,0,1,1,1,1,1,1,0,0,0,
0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,0,0,0,
0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,0,0,1,0,1,1,1,0,0,0,0,0,
0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,0,1,0,0,1,0,0,0,0,0,0,
1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,
1,1,1,1,1,1,1,1,0,0,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,
1,1,1,1,0,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

int1 mega_2[30][30]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,0,0,0,1,1,1,0,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,1,1,0,1,0,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,1,0,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,0,0,0,1,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

int1 mega_3[30][30]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,
0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,1,1,1,1,1,0,0,0,1,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,
0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,
0,0,0,0,1,1,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,0,
0,0,0,0,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,0,0,1,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,
0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,
0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,
0,0,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,
0,0,0,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

int1 heart_m[20][20]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,
0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,
0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,
0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

int1 heart_s[15][15]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,
0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,
0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,
0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

/*
int1 scott[34][40]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,
1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,
0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,
0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0, // FIN OLVIDADO
0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,
0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,
0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,
0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,
0,0,1,1,1,1,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,1,0,
0,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,1,0,
0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,
0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,
0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,0,0,
0,0,0,1,1,1,0,1,1,1,0,1,1,0,1,0,0,0,0,1,1,1,1,1,0,0,1,1,0,0,1,1,1,0,0,1,1,1,0,0,
0,0,0,1,1,1,0,1,1,1,0,1,1,0,1,0,0,0,0,1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,0,0,1,1,0,0,
0,0,0,0,0,1,0,0,0,1,0,1,1,0,1,0,0,0,0,1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,1,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,1,1,0,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,1,0,1,1,1,0,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,
0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};
*/

int1 phone1[20][20]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
0,1,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,
0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
0,1,1,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,
0,0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,
0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,
0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,
0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

int1 phone2[20][20]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,
0,1,1,1,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,
0,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,0,
0,1,1,1,1,1,0,0,0,1,1,1,0,0,1,1,0,0,0,0,
0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,
0,1,1,1,1,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,
0,0,1,1,1,1,0,0,0,0,0,0,0,1,0,1,1,0,0,0,
0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,
0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,
0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,
0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

int1 phone3[20][20]={
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,
0,0,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,
0,1,1,1,1,1,0,0,1,1,1,1,0,0,0,1,0,0,0,0,
0,1,1,1,1,1,0,0,0,0,0,0,1,1,0,0,1,0,0,0,
0,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,1,0,0,
0,1,1,1,1,1,0,0,0,1,1,1,0,0,1,1,0,1,0,0,
0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,1,0,0,1,0,
0,1,1,1,1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,
0,0,1,1,1,1,0,0,0,0,0,0,0,1,0,1,1,0,1,0,
0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,0,1,1,
0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,
0,0,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,
0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,
0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,
0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

// FUNCIONES SENSOR PASOS

void dibujar_mega_1()
{
   for(i=0;i<30;i++)
      for(j=0;j<30;j++)
         SSD1306_DrawPixel(A+j,B+i,mega_1[i][j]);
   SSD1306_Display();
}

void dibujar_mega_2()
{
   for(i=0;i<30;i++)
      for(j=0;j<30;j++)
         SSD1306_DrawPixel(A+j,B+i,mega_2[i][j]);
   SSD1306_Display();
}

void dibujar_mega_3()
{
   for(i=0;i<30;i++)
      for(j=0;j<30;j++)
         SSD1306_DrawPixel(A+j-2,B+i,mega_3[i][j]);
   SSD1306_Display();
}

void texto_data_st(int16 data_st)
{
   int16 u=0,d=0,c=0;
   u=data_st%10;
   d=data_st/10;
   d=d%10;
   c=data_st%1000;
   c=c/100;
   //m=data_st/1000;
   switch(u)
   {
      case 0:
         data_t_st[2]='0';
         break;
      case 1:
         data_t_st[2]='1';
         break;
      case 2:
         data_t_st[2]='2';
         break;
      case 3:
         data_t_st[2]='3';
         break;
      case 4:
         data_t_st[2]='4';
         break;
      case 5:
         data_t_st[2]='5';
         break;
      case 6:
         data_t_st[2]='6';
         break;
      case 7:
         data_t_st[2]='7';
         break;
      case 8:
         data_t_st[2]='8';
         break;
      case 9:
         data_t_st[2]='9';
         break;     
      default:
         data_t_st[2]='W';
         break;         
   }
   switch(d)
   {
      case 0:
         data_t_st[1]='0';
         break;
      case 1:
         data_t_st[1]='1';
         break;
      case 2:
         data_t_st[1]='2';
         break;
      case 3:
         data_t_st[1]='3';
         break;
      case 4:
         data_t_st[1]='4';
         break;
      case 5:
         data_t_st[1]='5';
         break;
      case 6:
         data_t_st[1]='6';
         break;
      case 7:
         data_t_st[1]='7';
         break;
      case 8:
         data_t_st[1]='8';
         break;
      case 9:
         data_t_st[1]='9';
         break;     
      default:
         data_t_st[1]='X';
         break;         
   }
   switch(c)
   {
      case 0:
         data_t_st[0]='0';
         break;
      case 1:
         data_t_st[0]='1';
         break;
      case 2:
         data_t_st[0]='2';
         break;
      case 3:
         data_t_st[0]='3';
         break;
      case 4:
         data_t_st[0]='4';
         break;
      case 5:
         data_t_st[0]='5';
         break;
      case 6:
         data_t_st[0]='6';
         break;
      case 7:
         data_t_st[0]='7';
         break;
      case 8:
         data_t_st[0]='8';
         break;
      case 9:
         data_t_st[0]='9';
         break;     
      default:
         data_t_st[0]='Y';
         break;         
   }
}

void revisar_boton()
{
   if(RD7)
      flag_push_st=1;
   if(flag_push_st==1)
   {
      flag_count_st++;
      while(RD7)
      {
         flag_push_st=1;
      }
      flag_push_st=0;
   }
   if(flag_push_st==0)
   {
      if(flag_count_st==5)
      {
         flag_count_st=0;
         count_st++;
      }
      texto_data_st(count_st);
      SSD1306_DrawChar(65,29,data_t_st[0],3);
      SSD1306_DrawChar(82,29,data_t_st[1],3);
      SSD1306_DrawChar(99,29,data_t_st[2],3);
      for(i=0;i<3;i++)
      {
         letter=data_t_st[i];
         if(letter=='0' || letter=='1' || letter=='2' || letter=='3' || letter=='4' || letter=='5' || letter=='6' || letter=='7' || letter=='8' || letter=='9')
            printf("%c",data_t_st[i]);
      }
      for(i=0;i<2;i++)
      {
         letter=salto_st[i];
         if(letter==0x0D || letter==0x0A)
            printf("%c",salto_st[i]);
      }
   }
}

// FUNCIONES SENSOR PULSO CARDIACO

void dibujar_heart_m()
{
   for(i=0;i<20;i++)
      for(j=0;j<20;j++)
         SSD1306_DrawPixel(C+j,D+i,heart_m[i][j]);
   SSD1306_Display();
}

void dibujar_heart_s()
{
   for(i=0;i<15;i++)
      for(j=0;j<15;j++)
         SSD1306_DrawPixel(C+2+j,D+2+i,heart_s[i][j]);
   SSD1306_Display();
}

int16 ADCAN0(void)
{
   int16 v1=0;
   ADCON0=0b00000001;
   delay_us(100);
   GO_DONE=1;
   while(GO_DONE==1);   
   v1=ADRESH<<8;
   v1=v1+ADRESL;
   return v1;
}

void texto_data(int16 data)
{
   int16 u=0,d=0,c=0,m=0;
   u=data%10;
   d=data/10;
   d=d%10;
   c=data%1000;
   c=c/100;
   m=data/1000;
   switch(u)
   {
      case 0:
         data_t[2]='0';
         break;
      case 1:
         data_t[2]='1';
         break;
      case 2:
         data_t[2]='2';
         break;
      case 3:
         data_t[2]='3';
         break;
      case 4:
         data_t[2]='4';
         break;
      case 5:
         data_t[2]='5';
         break;
      case 6:
         data_t[2]='6';
         break;
      case 7:
         data_t[2]='7';
         break;
      case 8:
         data_t[2]='8';
         break;
      case 9:
         data_t[2]='9';
         break;     
      default:
         data_t[2]='W';
         break;         
   }
   switch(d)
   {
      case 0:
         data_t[1]='0';
         break;
      case 1:
         data_t[1]='1';
         break;
      case 2:
         data_t[1]='2';
         break;
      case 3:
         data_t[1]='3';
         break;
      case 4:
         data_t[1]='4';
         break;
      case 5:
         data_t[1]='5';
         break;
      case 6:
         data_t[1]='6';
         break;
      case 7:
         data_t[1]='7';
         break;
      case 8:
         data_t[1]='8';
         break;
      case 9:
         data_t[1]='9';
         break;     
      default:
         data_t[1]='X';
         break;         
   }
   switch(c)
   {
      case 0:
         data_t[0]='0';
         break;
      case 1:
         data_t[0]='1';
         break;
      case 2:
         data_t[0]='2';
         break;
      case 3:
         data_t[0]='3';
         break;
      case 4:
         data_t[0]='4';
         break;
      case 5:
         data_t[0]='5';
         break;
      case 6:
         data_t[0]='6';
         break;
      case 7:
         data_t[0]='7';
         break;
      case 8:
         data_t[0]='8';
         break;
      case 9:
         data_t[0]='9';
         break;     
      default:
         data_t[0]='Y';
         break;         
   }
}

void conv_bpm()
{
   if(data==0 || data>555 || data<515)
   //if(data==0)
   {
      data=0;
      yz=yx;
      yx=56;
   }
   if(data==555)
   {
      data=100;
      yz=yx;
      yx=6;
   }
   if(data==554)
   {
      data=99;
      yz=yx;
      yx=7;
   }
   if(data==553)
   {
      data=98;
      yz=yx;
      yx=8;
   }
   if(data==552)
   {
      data=97;
      yz=yx;
      yx=9;
   }
   if(data==551)
   {
      data=96;
      yz=yx;
      yx=10;
   }
   if(data==550)
   {
      data=95;
      yz=yx;
      yx=11;
   }
   if(data==549)
   {
      data=94;
      yz=yx;
      yx=12;
   }
   if(data==548)
   {
      data=93;
      yz=yx;
      yx=13;
   }
   if(data==547)
   {
      data=92;
      yx=14;
   }
   if(data==546)
   {
      data=91;
      yz=yx;
      yx=15;
   }
   if(data==545)
   {
      data=90;
      yz=yx;
      yx=16;
   }
   if(data==544)
   {
      data=89;
      yz=yx;
      yx=17;
   }
   if(data==543)
   {
      data=88;
      yz=yx;
      yx=18;
   }
   if(data==542)
   {
      data=87;
      yz=yx;
      yx=19;
   }
   if(data==541)
   {
      data=86;
      yz=yx;
      yx=20;
   }
   if(data==540)
   {
      data=85;
      yz=yx;
      yx=21;
   }
   if(data==539)
   {
      data=84;
      yz=yx;
      yx=22;
   }
   if(data==538)
   {
      data=83;
      yz=yx;
      yx=23;
   }
   if(data==537)
   {
      data=82;
      yz=yx;
      yx=24;
   }
   if(data==536)
   {
      data=81;
      yz=yx;
      yx=25;
   }
   if(data==535)
   {
      data=80;
      yz=yx;
      yx=26;
   }
   if(data==534)
   {
      data=79;
      yz=yx;
      yx=27;
   }
   if(data==533)
   {
      data=78;
      yz=yx;
      yx=28;
   }
   if(data==532)
   {
      data=77;
      yz=yx;
      yx=29;
   }
   if(data==531)
   {
      data=76;
      yz=yx;
      yx=30;
   }
   if(data==530)
   {
      data=75;
      yz=yx;
      yx=31;
   }
   if(data==529)
   {
      data=74;
      yz=yx;
      yx=32;
   }
   if(data==528)
   {
      data=73;
      yz=yx;
      yx=33;
   }
   if(data==527)
   {
      data=72;
      yz=yx;
      yx=34;
   }
   if(data==526)
   {
      data=71;
      yz=yx;
      yx=35;
   }
   if(data==525)
   {
      data=70;
      yz=yx;
      yx=36;
   }
   if(data==524)
   {
      data=69;
      yz=yx;
      yx=37;
   }
   if(data==523)
   {
      data=68;
      yz=yx;
      yx=38;
   }
   if(data==522)
   {
      data=67;
      yz=yx;
      yx=39;
   }
   if(data==521)
   {
      data=66;
      yz=yx;
      yx=40;
   }
   if(data==520)
   {
      data=65;
      yz=yx;
      yx=41;
   }
   if(data==519)
   {
      data=64;
      yz=yx;
      yx=42;
   }
   if(data==518)
   {
      data=63;
      yz=yx;
      yx=43;
   }
   if(data==517)
   {
      data=62;
      yz=yx;
      yx=44;
   }
   if(data==516)
   {
      data=61;
      yz=yx;
      yx=45;
   }
   if(data==515)
   {
      data=60;
      yz=yx;
      yx=46;
   }
}

void graf()
{
   if(flag_p==0) // IMPRIMIR GRÁFICA SIN LATIDOS
   {
      if(yz==yx)
         SSD1306_DrawPixel(cg,yx,1);
      if(yz!=yx && cg>40)
      {
         SSD1306_DrawLine(cg-1,yz,cg,56,1);
      }
      cg++;
      if(cg==100)
      {
         cg=40;
         SSD1306_FillRect(40,2,60,55,0); // BORRAR GRÁFICA
      }
   }
   if(flag_p==1) // IMPRIMIR GRÁFICA LATIDOS
   {
      if(data>=60 && data<=100)
      {
         if(yz==yx)
         {
            SSD1306_DrawPixel(cg,yx,1);
         }
         if(yz!=yx && cg>40)
         {
            SSD1306_DrawLine(cg-1,yz,cg,yx,1);
         }
         cg++;
         if(cg==100)
         {
            cg=40;
            SSD1306_FillRect(40,2,60,55,0); // BORRAR GRÁFICA
         }
      }
   }
}

// FUNCIÓN CAMBIO DE PANTALLA

void screen_change()
{
   if(RD0)
      flag_push_screen=1;
   if(flag_push_screen==1)
   {
      while(RD0)
      {
         flag_push_screen=1;
      }
      flag_push_screen=0;
      flag_loop=0;
      screen++;
   }
   if(screen==4)
      screen=1;
   if(screen==5)
      screen=1;
}

// FUNCIONES LLAMADA
void dibujar_phone1()
{
   for(i=0;i<20;i++)
      for(j=0;j<20;j++)
         SSD1306_DrawPixel(E+j,F+i,phone1[i][j]);
   SSD1306_Display();
}

void dibujar_phone2()
{
   for(i=0;i<20;i++)
      for(j=0;j<20;j++)
         SSD1306_DrawPixel(E+j,F+i,phone2[i][j]);
   SSD1306_Display();
}

void dibujar_phone3()
{
   for(i=0;i<20;i++)
      for(j=0;j<20;j++)
         SSD1306_DrawPixel(E+j,F+i,phone3[i][j]);
   SSD1306_Display();
}
/*
void dibujar_scott()
{
   for(i=0;i<34;i++)
      for(j=0;j<40;j++)
         SSD1306_DrawPixel(G+j,H+i,scott[i][j]);
   SSD1306_Display();
}
*/
void dibujar_llamada()
{
   if(!strcmp(intep,"llamar")){
      
      pr_screen=screen;
      //screen=5;
      //count_l=0;
      SSD1306_ClearDisplay();
      int x=0;
      // TEXTOS
      SSD1306_DrawRect(0,0,128,64);
      SSD1306_DrawText(15,4,"LLAMADA ENTRANTE",1);
      SSD1306_DrawText(60,15,"SCOTT",1);
      SSD1306_DrawText(60,25,"PILGRIM",1);   
      //SSD1306_DrawText(100,37,"X",3);
      SSD1306_DrawLine(105,40,115,56,1); // SSD1306_DrawLine(100,40,110,56,1);
      SSD1306_DrawLine(105,56,115,40,1); // SSD1306_DrawLine(100,56,110,40,1);
      SSD1306_DrawRect(60,36,30,25); // RECTANGULO TELEFONO
      SSD1306_DrawRect(94,36,30,25); // RECTANGULO X
      //SSD1306_DrawRect(5,15,50,40);
      //SSD1306_DrawRect(10,19,40,32);
      //dibujar_scott();
      flag_loop=1;
      for(x=0;x<50;x++)
      {
         dibujar_phone1();
         delay_us(100);
         dibujar_phone2();
         delay_us(100);
         dibujar_phone3();
         delay_us(100);
      }
      /*for(i=0;i<8;i++)
         llamar[i]=0;*/
      //flag_loop=0;
      SSD1306_ClearDisplay();
      flag_loop=0;
      screen=pr_screen;
   }
   else{
      printf("Mal, recibi: ");
      printf("%s",intep);
   }
   
   for(int v=0;v<8;v++) llamar[v]=0;
}

#INT_RDA
void tecla()
{
   for(int v=0;v<10;v++){
      llamar[v] = getc();
      if(llamar[v] == '\n') v = 10;
   }
   sprintf(intep,"%c%c%c%c%c%c",llamar[0],llamar[1],llamar[2],llamar[3],llamar[4],llamar[5]);
   dibujar_llamada();
}

void main()
{
   TRISD=0xFF;
   SSD1306_Begin(SSD1306_SWITCHCAPVCC, SSD1306_I2C_ADDRESS);
   
   enable_interrupts(INT_RDA);
   enable_interrupts(GLOBAL);
   
   mytime = RTC_Get();
            
   mytime->hours   = 19;
   mytime->minutes = 28;
   mytime->seconds = 0;
   mytime->dow     = TUESDAY;
   mytime->day     = 10;
   mytime->month   = JANUARY;
   mytime->year    = 23;
         
   RTC_Set(mytime);
   IntSqw_Set(OUT_1Hz);
   // Configuración ADC
   ADCON1=0b00001110;
   ADCON2=0b10001000;
   SSD1306_ClearDisplay();
   for(;;)
   {
      while(screen==2)
      {
         flag_push_st=0;
         flag_count_st=0;
         SSD1306_ClearDisplay();
         flag_loop=1;
         SSD1306_DrawRect(0,0,128,64);
         SSD1306_DrawText(15,4,"CONTADOR DE PASOS",1);
         SSD1306_DrawLine(0,14,128,14,1);
         SSD1306_DrawRect(10,19,40,40);
         SSD1306_DrawRect(60,19,60,40);
         SSD1306_Display();
         while(flag_loop==1)
         {
            dibujar_mega_1();
            delay_ms(100);
            revisar_boton();
            screen_change();
            dibujar_mega_2();
            delay_ms(100);
            revisar_boton();
            screen_change();
            dibujar_mega_3();
            delay_ms(100);
            revisar_boton();
            screen_change();
            dibujar_mega_2();
            delay_ms(100);
            revisar_boton();
            screen_change();
         }
      }
      while(screen==3)
      {
         cg=40;
         yx=0;
         yz=0;
         data=0;
         flag_p=0;
         SSD1306_ClearDisplay();
         SSD1306_DrawRect(0,0,128,63);
         SSD1306_DrawLine(0,31,35,31,1);
         SSD1306_DrawLine(35,0,35,62,1);
         // LINEAS RECTA
         SSD1306_DrawLine(103,2,103,60,1); // PRUEBA LINEA VERTICAL
         //SSD1306_DrawLine(40,60,103,60,1); // PRUEBA LINEA HORIZONTAL
         SSD1306_DrawLine(102,6,104,6,1); // LINEA HORIZONTAL - 100
         SSD1306_DrawLine(102,16,104,16,1); // LINEA HORIZONTAL - 90
         SSD1306_DrawLine(102,26,104,26,1); // LINEA HORIZONTAL - 80
         SSD1306_DrawLine(102,36,104,36,1); // LINEA HORIZONTAL - 70
         SSD1306_DrawLine(102,46,104,46,1); // LINEA HORIZONTAL - 60
         SSD1306_DrawLine(102,56,104,56,1); // LINEA HORIZONTAL - 0
         // TEXTOS RECTA
         SSD1306_DrawText(8,4,"BPM:",1);
         SSD1306_DrawText(107,3,"100",1);
         SSD1306_DrawText(113,13,"90",1);
         SSD1306_DrawText(113,23,"80",1);
         SSD1306_DrawText(113,33,"70",1);
         SSD1306_DrawText(113,43,"60",1);
         SSD1306_DrawText(119,53,"0",1);
         SSD1306_Display();
         flag_loop=1;
         while(flag_loop==1)
         {
            dibujar_heart_s();
            for(i=0;i<10;i++)
               data+=ADCAN0();
            data=data/10;
            if(data>=900)
            {
               flag_p=0; // NO HAY DEDO COLOCADO
            }
            if(data>=0 && data<=100)
            {
               flag_p=1; // SE ACABA DE COLOCAR EL DEDO
            }
            if(flag_p==0)
               data=0;
            if(flag_p==1)
            {
               for(i=0;i<10;i++)
                  data+=ADCAN0();
               data=data/10;
            }
            conv_bpm();
            texto_data(data);
            SSD1306_DrawChar(8,15,data_t[0],1);
            SSD1306_DrawChar(14,15,data_t[1],1);
            SSD1306_DrawChar(20,15,data_t[2],1);
            for(i=0;i<3;i++)
            {
               letter=data_t[i];
               if(letter=='0' || letter=='1' || letter=='2' || letter=='3' || letter=='4' || letter=='5' || letter=='6' || letter=='7' || letter=='8' || letter=='9')
                  printf("%c",data_t[i]);
            }
            for(i=0;i<2;i++)
            {
               letter=salto[i];
               if(letter==0x0D || letter==0x0A)
                  printf("%c",salto[i]);
            }
            graf();
            delay_ms(500);
            dibujar_heart_m();
            SSD1306_FillRect(5,37,25,24,0);// BORRAR CORAZÓN
            data=0;
            screen_change();
         }
      }
      while(screen==1)
      {
         SSD1306_ClearDisplay();
         flag_loop=1;
         while(flag_loop==1)
         {
          
            
            sprintf(timp,"01:07:41");
            
            sprintf(fecha,"25-01-23");
           
            SSD1306_DrawLine(14,32,114,32);
           
            SSD1306_FillTriangle(6,24,14,32,6,40);
          
            SSD1306_FillTriangle(114,32,122,24,122,40);
         
            SSD1306_DrawText(16,12, timp, 2);
            
            SSD1306_DrawText(16,38, fecha, 2);
          
            SSD1306_Display();
           
            screen_change();
          
         }
      }
   }
}
